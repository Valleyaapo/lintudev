<section id="contact" class="section container pb-32 cv-auto">
  <!-- Success State -->
  <div id="contact-success" class="hidden tech-card p-16 text-center border-primary" tabindex="-1">
    <h3 class="text-3xl mb-4">Message Received</h3>
    <p class="text-text-muted">We'll be in touch shortly to discuss your project.</p>
    <button id="btn-send-another" class="btn-outline mt-8">Send Another</button>
  </div>

  <!-- Error State -->
  <div id="contact-error" class="hidden tech-card p-16 text-center border-red-500" tabindex="-1">
    <h3 class="text-3xl mb-4">Something Went Wrong</h3>
    <p class="text-text-muted">Please try again or email us directly at hello@lintu.dev</p>
    <button id="btn-try-again" class="btn-outline mt-8">Try Again</button>
  </div>

  <!-- Form State -->
  <div id="contact-form-container" class="grid grid-cols-1 md:grid-cols-2 gap-16">
    <div>
      <h2 class="text-3xl font-semibold mb-4">Start a Project</h2>
      <p class="text-text-muted mb-8 text-lg">
        Available for contract work and technical partnerships. Let's build something scalable.
      </p>
      <div class="mb-8">
        <span class="block text-text-muted text-sm mb-2">EMAIL</span>
        <a href="mailto:hello@lintu.dev" class="text-xl hover:text-primary transition-colors">hello@lintu.dev</a>
      </div>
    </div>

    <form id="contact-form" class="grid gap-6">
      {/* Honeypot field - invisible spam trap */}
      <input
        type="text"
        name="website"
        style="display: none;"
        tabindex="-1"
        autocomplete="off"
      />
      <div>
        <label class="block text-sm text-text-muted mb-2">NAME</label>
        <input
          required
          type="text"
          name="name"
          class="w-full bg-surface border border-border p-4 text-text-main font-inherit focus:outline-none focus:border-primary transition-colors"
          placeholder="Jane Doe"
        />
      </div>
      <div>
        <label class="block text-sm text-text-muted mb-2">EMAIL</label>
        <input
          required
          type="email"
          name="email"
          class="w-full bg-surface border border-border p-4 text-text-main font-inherit focus:outline-none focus:border-primary transition-colors"
          placeholder="jane@company.com"
        />
      </div>
      <div>
        <label class="block text-sm text-text-muted mb-2">PROJECT DETAILS</label>
        <textarea
          required
          rows="4"
          name="message"
          class="w-full bg-surface border border-border p-4 text-text-main font-inherit focus:outline-none focus:border-primary transition-colors resize-none"
          placeholder="Tell us about the scope and timeline..."
        ></textarea>
      </div>

      <button
        type="submit"
        id="btn-submit"
        class="btn-primary justify-self-start disabled:opacity-70"
      >
        Send Message
      </button>
    </form>
  </div>
</section>

<script>
  const form = document.getElementById('contact-form');
  const successDiv = document.getElementById('contact-success');
  const errorDiv = document.getElementById('contact-error');
  const formContainer = document.getElementById('contact-form-container');
  const sendAnotherBtn = document.getElementById('btn-send-another');
  const tryAgainBtn = document.getElementById('btn-try-again');
  const submitBtn = document.getElementById('btn-submit');

  if (form && successDiv && errorDiv && formContainer && sendAnotherBtn && tryAgainBtn && submitBtn) {
    const showState = (state) => {
      successDiv.classList.add('hidden');
      errorDiv.classList.add('hidden');
      formContainer.classList.add('hidden');

      if (state === 'form') {
        formContainer.classList.remove('hidden');
      } else if (state === 'success') {
        successDiv.classList.remove('hidden');
        successDiv.focus();
      } else if (state === 'error') {
        errorDiv.classList.remove('hidden');
        errorDiv.focus();
      }
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Loading state
      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Sending...';
      submitBtn.setAttribute('aria-busy', 'true');

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          showState('success');
          form.reset();
        } else {
          showState('error');
        }
      } catch (error) {
        console.error('Form submission error:', error);
        showState('error');
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        submitBtn.setAttribute('aria-busy', 'false');
      }
    });

    sendAnotherBtn.addEventListener('click', () => {
      showState('form');
    });

    tryAgainBtn.addEventListener('click', () => {
      showState('form');
    });
  }
</script>
