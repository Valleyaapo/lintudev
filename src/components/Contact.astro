<section id="contact" class="section container pb-32 cv-auto">
  <!-- Success Message -->
  <div id="contact-success" class="hidden tech-card p-16 text-center border-primary">
    <h3 class="text-3xl mb-4">Message Received</h3>
    <p class="text-text-muted">We'll be in touch shortly to discuss your project.</p>
    <button id="btn-reset-success" class="btn-outline mt-8">
      Send Another
    </button>
  </div>

  <!-- Error Message -->
  <div id="contact-error" class="hidden tech-card p-16 text-center border-red-500">
    <h3 class="text-3xl mb-4">Something Went Wrong</h3>
    <p class="text-text-muted">Please try again or email us directly at hello@lintu.dev</p>
    <button id="btn-reset-error" class="btn-outline mt-8">
      Try Again
    </button>
  </div>

  <!-- Form Section -->
  <div id="contact-default" class="grid grid-cols-1 md:grid-cols-2 gap-16">
    <div>
      <h2 class="text-3xl font-semibold mb-4">Start a Project</h2>
      <p class="text-text-muted mb-8 text-lg">
        Available for contract work and technical partnerships. Let's build something scalable.
      </p>
      <div class="mb-8">
        <span class="block text-text-muted text-sm mb-2">EMAIL</span>
        <a href="mailto:hello@lintu.dev" class="text-xl hover:text-primary transition-colors">hello@lintu.dev</a>
      </div>
    </div>

    <form id="contact-form" class="grid gap-6">
      <!-- Honeypot field - invisible spam trap -->
      <input
        type="text"
        name="website"
        style="display: none"
        tabindex="-1"
        autocomplete="off"
      />
      <div>
        <label class="block text-sm text-text-muted mb-2">NAME</label>
        <input
          required
          type="text"
          name="name"
          class="w-full bg-surface border border-border p-4 text-text-main font-inherit focus:outline-none focus:border-primary transition-colors"
          placeholder="Jane Doe"
        />
      </div>
      <div>
        <label class="block text-sm text-text-muted mb-2">EMAIL</label>
        <input
          required
          type="email"
          name="email"
          class="w-full bg-surface border border-border p-4 text-text-main font-inherit focus:outline-none focus:border-primary transition-colors"
          placeholder="jane@company.com"
        />
      </div>
      <div>
        <label class="block text-sm text-text-muted mb-2">PROJECT DETAILS</label>
        <textarea
          required
          rows="4"
          name="message"
          class="w-full bg-surface border border-border p-4 text-text-main font-inherit focus:outline-none focus:border-primary transition-colors resize-none"
          placeholder="Tell us about the scope and timeline..."
        ></textarea>
      </div>

      <button
        type="submit"
        id="btn-submit"
        class="btn-primary justify-self-start disabled:opacity-70"
      >
        Send Message
      </button>
    </form>
  </div>
</section>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const successDiv = document.getElementById('contact-success');
  const errorDiv = document.getElementById('contact-error');
  const defaultDiv = document.getElementById('contact-default');
  const submitBtn = document.getElementById('btn-submit') as HTMLButtonElement;
  const resetSuccessBtn = document.getElementById('btn-reset-success');
  const resetErrorBtn = document.getElementById('btn-reset-error');

  if (form && successDiv && errorDiv && defaultDiv && submitBtn) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Update UI to submitting state
      submitBtn.disabled = true;
      const originalBtnText = submitBtn.textContent;
      submitBtn.textContent = 'Sending...';

      try {
        const formData = new FormData(form);
        const payload = Object.fromEntries(formData);

        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload),
        });

        if (response.ok) {
          // Success
          defaultDiv.classList.add('hidden');
          successDiv.classList.remove('hidden');
          form.reset();
        } else {
          // Error
          defaultDiv.classList.add('hidden');
          errorDiv.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Form submission error:', error);
        defaultDiv.classList.add('hidden');
        errorDiv.classList.remove('hidden');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalBtnText;
      }
    });

    const resetForm = () => {
      successDiv.classList.add('hidden');
      errorDiv.classList.add('hidden');
      defaultDiv.classList.remove('hidden');
    };

    resetSuccessBtn?.addEventListener('click', resetForm);
    resetErrorBtn?.addEventListener('click', resetForm);
  }
</script>
