---
import type { Project } from '../data/projects';

interface Props {
  project: Project;
  nextProject?: Project;
}

const { project, nextProject } = Astro.props as Props;
---

<div class="container section mt-24 slide-up-fade">
  <div class="mb-16 pb-8 border-b border-border">
    <h1 class="text-4xl md:text-6xl lg:text-7xl font-extrabold mb-6 leading-none break-words">
      {project.title}
    </h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      <div>
        <span class="block text-text-muted text-sm mb-2">CLIENT</span>
        <span class="block font-semibold">{project.client}</span>
      </div>
      <div>
        <span class="block text-text-muted text-sm mb-2">CATEGORY</span>
        <span class="block font-semibold">{project.category}</span>
      </div>
      <div>
        <span class="block text-text-muted text-sm mb-2">YEAR</span>
        <span class="block font-semibold">{project.year}</span>
      </div>
      <div>
        <span class="block text-text-muted text-sm mb-2">ROLE</span>
        <span class="block font-semibold">{project.service}</span>
      </div>
    </div>

    {project.links && project.links.length > 0 && (
      <div class="flex flex-wrap gap-3 mt-8">
        {project.links.map((link) => {
          const isAppStore = link.url.includes('apps.apple.com');
          
          if (isAppStore) {
            return (
              <a
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-block transition-opacity hover:opacity-80"
              >
                <img 
                  src="https://tools.applemediaservices.com/api/badges/download-on-the-app-store/black/en-us?size=250x83&releaseDate=1280620800" 
                  alt="Download on the App Store"
                  class="h-10"
                  loading="lazy"
                />
              </a>
            );
          }
          
          return (
            <a
              href={link.url}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-5 py-2.5 bg-transparent border border-border rounded-lg font-medium text-sm text-text-main transition-all hover:border-primary hover:text-primary hover:shadow-lg hover:shadow-primary/10"
            >
              {link.label}
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            </a>
          );
        })}
      </div>
    )}
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-20">
    <div>
      <h2 class="text-2xl font-bold mb-4">Challenge</h2>
      <p class="text-text-muted leading-relaxed">{project.challenge}</p>
    </div>
    <div>
      <h2 class="text-2xl font-bold mb-4">Solution</h2>
      <p class="text-text-muted leading-relaxed">{project.solution}</p>
    </div>
  </div>

  <div class="mb-20 cv-auto">
    <h2 class="text-2xl font-bold mb-6">Key Features</h2>
    <ul class="grid grid-cols-1 md:grid-cols-2 gap-4 list-disc list-inside text-text-muted">
      {project.features.map((feature) => (
        <li>{feature}</li>
      ))}
    </ul>
  </div>

  <div class="mb-20 cv-auto">
    <img
      src={project.heroImage}
      alt={project.title}
      class="w-full aspect-video object-cover rounded-lg border border-border"
      loading="eager"
      decoding="async"
      fetchpriority="high"
    />
  </div>

  <div class="mb-20 pb-20 border-b border-border cv-auto">
    <h2 class="text-2xl font-bold mb-8">Project Gallery</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <img
        src={`/assets/${project.id}-1.jpg`}
        alt={`${project.title} 1`}
        class="w-full aspect-square object-cover rounded-lg border border-border"
        loading="lazy"
        decoding="async"
        fetchpriority="low"
      />
      <img
        src={`/assets/${project.id}-2.jpg`}
        alt={`${project.title} 2`}
        class="w-full aspect-square object-cover rounded-lg border border-border"
        loading="lazy"
        decoding="async"
        fetchpriority="low"
      />
    </div>
  </div>

  {nextProject && (
    <div class="flex justify-between items-center">
      <span class="text-text-muted">Next Project</span>
      {/* Prefetch for instant navigation */}
      <a class="group inline-flex items-center gap-3 text-primary" href={`/project/${nextProject.id}`} data-astro-prefetch>
        <span class="group-hover:text-primary transition-colors">
          {nextProject.title.toUpperCase()} &rarr;
        </span>
      </a>
    </div>
  )}
</div>
